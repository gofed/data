{"artefact": "golang-project-repository-commit", "repository": {"username": "fsnotify", "project": "fsnotify", "provider": "github"}, "author": "Tom Payne <twpayne@gmail.com>", "cdate": 1490100922, "adate": 1490100922, "commit": "ff7bc41d4007f67e5456703c34342df4e0113f64", "message": "Watch.Add improvements (avoid race, fix consistency, reduce garbage) (#189)\n\n* hold mutex for longer to avoid race condition\r\n\r\nIf Watcher.Add is called with the same name from multiple goroutines and\r\nname is not already in the watches map then the last call to complete\r\nwins and the watch created by the first call to complete is lost.\r\n\r\nThis commit holds the mutex for the full duration of the update to the\r\nwatches map.\r\n\r\n* avoid clobbering existing flags if inotify_add_watch fails\r\n\r\nPreviously, the watch entry is the watches map was updated before the\r\ncall to InotifyAddWatch. If InotifyAddWatch fails then this left the\r\nwatch entry in an inconsistent state.\r\n\r\n* reuse existing watch entry when possible\r\n"}